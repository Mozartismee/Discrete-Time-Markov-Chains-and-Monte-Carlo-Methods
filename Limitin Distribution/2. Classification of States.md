---
created: 2025-10-03 18:47:43
updated: 2025-10-03 18:48:39
---

# 模組 2：Classification of States（完整筆記）

> 任務重點：建立馬可夫鏈狀態的分類框架——**暫留（transient）**與**再返（recurrent）**——從單一狀態上升到「通信類」視角；並量化**暫留狀態**的回返次數期望。

---

## 0）設定與記號

- 狀態空間：有限或可數 $S$
- 轉移矩陣：$P=[p_{ij}]_{i,j\in S}$，$p_{ij}=\Pr(X_{n+1}=j\mid X_n=i)$
- $n$ 步轉移機率：$p^{(n)}_{ij}=\Pr(X_n=j\mid X_0=i)$
- Chapman–Kolmogorov（CK）：
  - 矩陣式：$P^{m+n}=P^mP^n$
  - 元素式：$p^{(m+n)}_{ij}=\sum_{k\in S}p^{(m)}_{ik}p^{(n)}_{kj}$

---

## 1）可達、通信與通信類

### 1.1 可達（reachability）
- $i\to j$：存在 $n\ge 0$ 使 $p^{(n)}_{ij}>0$。特別地，$i\to i$ 因 $p^{(0)}_{ii}=1$。

### 1.2 通信（communication）
- $i\leftrightarrow j$：$i\to j$ 且 $j\to i$。
- **命題**：$\leftrightarrow$ 為等價關係（反身、對稱、傳遞），將 $S$ 劃分為**通信類**（equivalence classes）。

### 1.3 閉通信類（closed class）
- 若從類 $C$ 以正機率**無法離開**（即對 $i\in C$、$j\notin C$ 有 $p_{ij}=0$），則 $C$ 為**閉類**。

---

## 2）暫留與再返（核心定義）

- **回返時間**：$T_i=\min\{n\ge 1:X_n=i\}$
- **回返機率**：$f_{ii}=\Pr_i(T_i<\infty)$
- **再返（recurrent）**：$f_{ii}=1$
- **暫留（transient）**：$f_{ii}<1$（等價於有正機率最終逃離 $i$ 並不再回返）

> 提醒：$p^{(n)}_{ii}$ 表示「第 $n$ 步在 $i$」，**不是**「首次回返在第 $n$ 步」的機率；「首次回返」事件在不同 $n$ 是互斥的，但「第 $n$ 步在 $i$」並非互斥，因此不可直接相加作為「回返機率」。

---

## 3）級數刻畫：再返/暫留的硬規則

**定理（級數判別）**  
$$
i\ \text{再返}\ \Longleftrightarrow\ \sum_{n=1}^{\infty}p^{(n)}_{ii}=\infty,\qquad
i\ \text{暫留}\ \Longleftrightarrow\ \sum_{n=1}^{\infty}p^{(n)}_{ii}<\infty.
$$

**證明骨架（技巧：指示函數與線性期望）**  
令 $N=\sum_{n\ge 1}\mathbf{1}_{\{X_n=i\}}$（不含 $n=0$ 初訪）。  
則
$$
\mathbb{E}_i[N]=\sum_{n\ge 1}\mathbb{E}_i[\mathbf{1}_{\{X_n=i\}}]
=\sum_{n\ge 1}\Pr_i(X_n=i)
=\sum_{n\ge 1}p^{(n)}_{ii}.
$$
暫留時可證 $\mathbb{E}_i[N]=\dfrac{f_{ii}}{1-f_{ii}}<\infty$，反向亦成立。

---

## 4）類性質與有限鏈的結構

### 4.1 類性質（class property）
- **命題**：若 $i\leftrightarrow j$，則
  - $i$ 暫留 $\iff$ $j$ 暫留
  - $i$ 再返 $\iff$ $j$ 再返
- **證明思路**（CK「雙停靠」不等式）：若存在 $m,n$ 使 $p^{(m)}_{ji}>0$、$p^{(n)}_{ij}>0$，則
  $$
  p^{(m+k+n)}_{jj}\ \ge\ p^{(m)}_{ji}\,p^{(k)}_{ii}\,p^{(n)}_{ij}.
  $$
  對 $k$ 求和把「發散性」從 $i$ 傳給 $j$。

### 4.2 有限鏈結構
- 至少存在一個**閉通信類**；任何**有限閉類**皆**再返**。
- 一般有限鏈可分為：若干閉（再返）類 +（最終流入閉類的）暫留部分。
- 若鏈**不可約**（只有一個通信類），則**全體再返**（更強：全體正再返）。

---

## 5）暫留狀態的回返次數期望

令 $N=\sum_{n\ge 1}\mathbf{1}_{\{X_n=i\}}$，為從 $i$ 出發、時間 $n\ge 1$ 的**回返次數**。

- **分佈結構**（強馬可夫性）：每次回返後，之後再回返的機率仍為 $f_{ii}$，故
  $$
  \Pr_i(N=k)=(f_{ii})^k(1-f_{ii}),\quad k=0,1,2,\dots
  $$
- **兩個常用期望**
  - 回返次數期望（不含初訪）：$\displaystyle \mathbb{E}_i[N]=\frac{f_{ii}}{1-f_{ii}}$
  - 總訪問次數期望（含初訪於 $n=0$）：$\displaystyle \sum_{n\ge 0}\Pr_i(X_n=i)=1+\mathbb{E}_i[N]=\frac{1}{1-f_{ii}}$

> 與吸收鏈框架對應：暫留子鏈之基本矩陣 $N=(I-Q)^{-1}$ 的對角元即為「總訪問次數期望」。

---

## 6）分類語彙與快速判據

- **狀態層級**
  - 再返：$f_{ii}=1$
  - 暫留：$f_{ii}<1$
- **類層級**
  - 再返類：類內皆再返（有限閉類自動再返）
  - 暫留類：類內皆暫留（終將流入某閉類）
- **有限不可約鏈**：全體再返（更強：全體**正**再返）

**快速流程**
1. 畫圖找**通信類**；標註哪些是**閉類**。  
2. 閉類皆再返；非閉類皆暫留。  
3. 若鏈不可約 ⇒ 全體再返（有限時更是正再返）。  
4. 需要量化暫留行為時，對暫留子鏈取 $Q$，計算 $N=(I-Q)^{-1}$。

---

## 7）範例骨架（五狀態矩陣的心法）

- 讀矩陣（或圖）：
  - $\{1,3\}$ 只互通且離不開 ⇒ **閉類** ⇒ 類內再返
  - $\{2,4,5\}$ 能進 $\{1,3\}$ 且回不來 ⇒ **非閉** ⇒ 暫留
- 結論：$1,3$ 再返；$2,4,5$ 暫留  
- 延伸：若要求從 $2$ 出發命中特定閉類的機率、或回到 $2$ 的期望次數，以暫留子鏈 $Q$、遷入矩陣 $R$ 建立吸收鏈並用 $N=(I-Q)^{-1}$ 計算。

---

## 8）常見誤解與糾錯

- 把 $\sum_{n\ge 1}p^{(n)}_{ii}$ 誤解為「回返機率」：各項非互斥，該和僅為**刻畫量**，用於判斷收斂/發散。
- 忽略**類性質**：判了單一狀態卻未推及全類。
- 以為「有限 ⇒ 全體再返」：僅對**不可約**鏈；一般有限鏈是「至少一個閉再返類 + 其他暫留」。
- 混淆「首次回返」與「在位機率」：處理和式時須確保事件互斥性。

---

## 9）一頁速查（Cheat Sheet）

- 定義：$T_i$, $f_{ii}$；再返 $f_{ii}=1$、暫留 $f_{ii}<1$
- 硬規則：$i$ 再返 $\Leftrightarrow \sum_{n\ge 1}p^{(n)}_{ii}=\infty$
- 類性質：再返/暫留在通信類內一致
- 有限閉類皆再返；有限不可約鏈 ⇒ 全體再返（且正再返）
- 暫留回返次數期望：$\mathbb{E}_i[N]=\dfrac{f_{ii}}{1-f_{ii}}$；總訪問（含初訪）期望：$\dfrac{1}{1-f_{ii}}$
- 工具：強馬可夫性、指示函數期望等於事件機率、CK 分解與「挑單項」下界不等式

---